"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.statsForMap = void 0;
const accumulateEvents_1 = require("./accumulateEvents");
const KILOBYTE = 1000;
const MEGABYTE = KILOBYTE * 1000;
const GIGABYTE = MEGABYTE * 1000;
function displaySize(size) {
    let divisor;
    let suffix;
    if (size > GIGABYTE) {
        divisor = GIGABYTE;
        suffix = 'GB';
    }
    else if (size > MEGABYTE) {
        divisor = MEGABYTE;
        suffix = 'MB';
    }
    else if (size > KILOBYTE) {
        divisor = KILOBYTE;
        suffix = 'KB';
    }
    else {
        divisor = 1;
        suffix = 'bytes';
    }
    return `${(size / divisor).toFixed(1)} ${suffix}`;
}
async function statsForMap(format, limit, mapPath) {
    const eventsStats = (await (0, accumulateEvents_1.accumulateEvents)(mapPath)).slice(0, limit);
    if (format === 'json') {
        console.log(JSON.stringify(eventsStats, null, 2));
    }
    else {
        eventsStats.forEach((callData, index) => {
            const { function: fn, count, size } = callData;
            console.log([`${index + 1}. ${fn}`, `count: ${count}`, `estimated size: ${displaySize(size)}`, ''].join('\n      '));
        });
    }
    return eventsStats;
}
exports.statsForMap = statsForMap;
//# sourceMappingURL=statsForMap.js.map