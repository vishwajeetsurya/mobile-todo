"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const promises_1 = require("fs/promises");
const js_yaml_1 = require("js-yaml");
const openapi_types_1 = require("openapi-types");
const utils_1 = require("../../../utils");
async function collectRoutes(openapiFile, resourceTokens, routeCountByResource, routeCountByContentType) {
    if (!(await (0, utils_1.exists)(openapiFile)))
        return;
    const openapi = (0, js_yaml_1.load)(await (0, promises_1.readFile)(openapiFile, 'utf-8'));
    for (const pattern of Object.keys(openapi.paths)) {
        const pathItem = openapi.paths[pattern];
        if (!pathItem)
            continue;
        for (const method of Object.values(openapi_types_1.OpenAPIV3.HttpMethods)) {
            const operation = pathItem[method];
            if (!operation)
                continue;
            const directoryIsh = pattern.split('/').slice(0, resourceTokens).join('/');
            if (!routeCountByResource[directoryIsh])
                routeCountByResource[directoryIsh] = 1;
            else
                routeCountByResource[directoryIsh] = routeCountByResource[directoryIsh] + 1;
            for (const responseOption of Object.values(operation.responses)) {
                const response = responseOption;
                if (response.content) {
                    for (const contentType of Object.keys(response.content)) {
                        if (!routeCountByContentType[contentType])
                            routeCountByContentType[contentType] = 1;
                        else
                            routeCountByContentType[contentType] = routeCountByContentType[contentType] + 1;
                    }
                }
            }
        }
    }
}
exports.default = collectRoutes;
//# sourceMappingURL=collectRoutes.js.map