"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const assert_1 = __importDefault(require("assert"));
const utils_1 = require("../../utils");
class BrowserRenderer {
    constructor(showBrowser = false) {
        this.showBrowser = showBrowser;
        this.showBrowser = showBrowser;
        this._browser = undefined;
    }
    async screenshot(url, outputPath) {
        await this.initialize();
        (0, assert_1.default)(this._browser);
        const page = await this._browser.newPage();
        if ((0, utils_1.verbose)())
            page.on('console', (msg) => console.log('CONSOLE: ', msg.text()));
        if ((0, utils_1.verbose)())
            console.warn(`Rendering ${url} to ${outputPath}`);
        await page.goto(url);
        await page.waitForSelector('.sequence-diagram');
        await page.screenshot({ path: outputPath, fullPage: true });
    }
    async close() {
        if (this._browser) {
            await this._browser.close();
            this._browser = undefined;
        }
    }
    async initialize() {
        if (this._browser)
            return this._browser;
        const puppeteer = require('puppeteer');
        if ((0, utils_1.verbose)())
            console.warn(`Preparing browser for PNG rendering`);
        this._browser = await puppeteer.launch({ timeout: 120 * 1000, headless: !this.showBrowser });
    }
}
exports.default = BrowserRenderer;
//# sourceMappingURL=browserRenderer.js.map