"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const userInteraction_1 = __importDefault(require("../../userInteraction"));
const remoteRecording_1 = __importDefault(require("../remoteRecording"));
const nameAppMap_1 = __importDefault(require("./nameAppMap"));
const saveAppMap_1 = __importDefault(require("./saveAppMap"));
async function saveRecording(recordContext) {
    const rr = new remoteRecording_1.default(recordContext.configuration.requestOptions());
    let data = await rr.stop();
    if (data) {
        userInteraction_1.default.success(`Recording has finished, with ${data.length} bytes of data.`);
    }
    else {
        userInteraction_1.default.warn(`Recording was stopped, but no data was obtained.`);
        recordContext.appMapCount = 0;
        recordContext.appMapEventCount = 0;
        return;
    }
    const jsonData = JSON.parse(data);
    if (jsonData.events) {
        recordContext.appMapCount = 1;
        recordContext.appMapEventCount = jsonData.events.length;
    }
    const appMapName = await (0, nameAppMap_1.default)(jsonData);
    return (0, saveAppMap_1.default)(recordContext, jsonData, appMapName);
}
exports.default = saveRecording;
//# sourceMappingURL=saveRecording.js.map