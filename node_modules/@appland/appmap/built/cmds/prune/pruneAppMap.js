"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.pruneWithFilter = exports.pruneAppMap = void 0;
const models_1 = require("@appland/models");
const pruneAppMap = (appMap, size) => {
    // I'm not sure what the purpose of the local AppMap interface is, but I'll maintain it for now.
    const appmap = (0, models_1.buildAppMap)().source(appMap).prune(size).normalize().build();
    return { appmap };
};
exports.pruneAppMap = pruneAppMap;
const pruneWithFilter = (appMap, serializedFilter) => {
    // TODO: update type for AppMap
    const fullMap = (0, models_1.buildAppMap)().source(appMap).normalize().build();
    const previousFilterState = fullMap.data.pruneFilter;
    let previousFilter;
    if (previousFilterState)
        previousFilter = (0, models_1.deserializeFilter)(previousFilterState);
    let filterState = (0, models_1.filterStringToFilterState)(serializedFilter);
    if (previousFilterState)
        filterState = (0, models_1.mergeFilterState)(filterState, previousFilterState);
    const appmapFilter = (0, models_1.deserializeFilter)(filterState);
    const prunedMap = appmapFilter.filter(fullMap, []);
    prunedMap.data = Object.assign(Object.assign({}, prunedMap.data), { pruneFilter: (0, models_1.serializeFilter)(appmapFilter) });
    return { appmap: prunedMap, filter: appmapFilter };
};
exports.pruneWithFilter = pruneWithFilter;
//# sourceMappingURL=pruneAppMap.js.map