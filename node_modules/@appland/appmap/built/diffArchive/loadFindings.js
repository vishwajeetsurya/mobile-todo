"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const promises_1 = require("fs/promises");
const utils_1 = require("../utils");
async function loadFindings(paths, revisionName, appMapDir) {
    const findings = new Array();
    const collectFindings = (findings) => {
        return async (findingsFile) => {
            const findingsData = JSON.parse(await (0, promises_1.readFile)(findingsFile, 'utf-8'));
            findings.push(...findingsData.findings);
        };
    };
    await (0, utils_1.processNamedFiles)(paths.revisionPath(revisionName), 'appmap-findings.json', collectFindings(findings));
    console.info(`Found ${findings.length} findings for ${revisionName} revision`);
    for (const finding of findings) {
        if (finding.appMapFile.startsWith(appMapDir)) {
            finding.appMapFile = finding.appMapFile.slice(appMapDir.length + 1);
        }
    }
    return findings;
}
exports.default = loadFindings;
//# sourceMappingURL=loadFindings.js.map