"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.resolvePath = void 0;
const path_1 = require("path");
const utils_1 = require("../utils");
const glob_1 = require("glob");
const util_1 = require("util");
/**
 * Resolve a path to an actual file that exists within the working directory.
 * If the languageName is Java, the directory tree will be searched for the path. This is
 * because Java files are organized into a directory structure that matches the package
 * names, but the root of that directory structure is not known.
 * If there are multiple matching files, the shortest path is returned.
 */
async function resolvePath(path, languageName) {
    // Normalize absolute path to relative path, if the path is within the source tree.
    if (path.startsWith(process.cwd()))
        path = path.slice(process.cwd().length + 1);
    // Discard paths that are outside the source tree.
    if ((0, path_1.isAbsolute)(path))
        return;
    // Return the path if it exists.
    if (await (0, utils_1.exists)(path))
        return path;
    // Search for the path if the language is Java.
    if (!languageName)
        return;
    if (languageName.toLowerCase() === 'java') {
        const matches = (await (0, util_1.promisify)(glob_1.glob)(`**/${path}`)).sort((a, b) => a.length - b.length);
        if (matches.length === 0)
            return;
        return matches[0];
    }
}
exports.resolvePath = resolvePath;
//# sourceMappingURL=resolvePath.js.map